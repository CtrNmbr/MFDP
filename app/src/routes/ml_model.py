import json
import uuid
from typing import List

from fastapi import APIRouter, HTTPException, Depends
from fastapi.security import OAuth2PasswordBearer

from app.src.base.constants import TaskStatus
from app.src.database.database import get_session
from app.src.dto.prediction import Prediction
from app.src.dto.prediction_request import PredictionRequest
from app.src.models.account_transaction import AccountTransaction
from app.src.models.predict_task import PredictTask
from app.src.services.account_service import AccountService
from app.src.services.crud.predict_task import create_predict_task, get_predict_task
from app.src.services.crud.prediction import get_predictions
from app.src.services.rabbitmq_task_service import send_task_to_queue
from app.src.services.transaction_service import TransactionService
from app.src.services.user_service import UserService

ml_model_router = APIRouter(tags=["ML Model"])

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token") #OAuth2PasswordBearer(tokenUrl="/user/signin") #OAuth2PasswordBearer(tokenUrl="token")


@ml_model_router.post("/predict")
def predict(
    predication_request: PredictionRequest,
    token: str = Depends(oauth2_scheme),
    session=Depends(get_session),
):
    """Анализ качества вина"""

    user_id = UserService.verify_token(token)
    if user_id is None:
        raise HTTPException(status_code=401, detail="Invalid token")

    account_service = AccountService(TransactionService())

    transaction_result = account_service.create_payment(
        user_id, session
    )
    if not isinstance(transaction_result, AccountTransaction):
        return transaction_result

    # create task
    predict_task = PredictTask(
        user_id=user_id,
        status=TaskStatus.CREATED,
        TransactionID = predication_request.TransactionID,
        id_01 = predication_request.id_01,
        id_02 = predication_request.id_02,
        id_03 = predication_request.id_03,
        id_04 = predication_request.id_04,
        id_05 = predication_request.id_05,
        id_06 = predication_request.id_06,
        id_07 = predication_request.id_07,
        id_08 = predication_request.id_08,
        id_09 = predication_request.id_09,
        id_10 = predication_request.id_10,
        id_11 = predication_request.id_11,
        id_12 = predication_request.id_12,
        id_13 = predication_request.id_13,
        id_14 = predication_request.id_14,
        id_15 = predication_request.id_15,
        id_16 = predication_request.id_16,
        id_17 = predication_request.id_17,
        id_18 = predication_request.id_18,
        id_19 = predication_request.id_19,
        id_20 = predication_request.id_20,
        id_21 = predication_request.id_21,
        id_22 = predication_request.id_22,
        id_23 = predication_request.id_23,
        id_24 = predication_request.id_24,
        id_25 = predication_request.id_25,
        id_26 = predication_request.id_26,
        id_27 = predication_request.id_27,
        id_28 = predication_request.id_28,
        id_29 = predication_request.id_29,
        id_30 = predication_request.id_30,
        id_31 = predication_request.id_31,
        id_32 = predication_request.id_32,
        id_33 = predication_request.id_33,
        id_34 = predication_request.id_34,
        id_35 = predication_request.id_35,
        id_36 = predication_request.id_36,
        id_37 = predication_request.id_37,
        id_38 = predication_request.id_38,
        DeviceType = predication_request.DeviceType,
        DeviceInfo = predication_request.DeviceInfo,
        TransactionDT = predication_request.TransactionDT,
        TransactionAmt = predication_request.TransactionAmt,
        ProductCD = predication_request.ProductCD,
        card1 = predication_request.card1,
        card2 = predication_request.card2,
        card3 = predication_request.card3,
        card4 = predication_request.card4,
        card5 = predication_request.card5,
        card6 = predication_request.card6,
        addr1 = predication_request.addr1,
        addr2 = predication_request.addr2,
        dist1 = predication_request.dist1,
        dist2 = predication_request.dist2,
        P_emaildomain = predication_request.P_emaildomain,
        R_emaildomain = predication_request.R_emaildomain,
        C1 = predication_request.C1,
        C2 = predication_request.C2,
        C3 = predication_request.C3,
        C4 = predication_request.C4,
        C5 = predication_request.C5,
        C6 = predication_request.C6,
        C7 = predication_request.C7,
        C8 = predication_request.C8,
        C9 = predication_request.C9,
        C10 = predication_request.C10,
        C11 = predication_request.C11,
        C12 = predication_request.C12,
        C13 = predication_request.C13,
        C14 = predication_request.C14,
        D1 = predication_request.D1,
        D2 = predication_request.D2,
        D3 = predication_request.D3,
        D4 = predication_request.D4,
        D5 = predication_request.D5,
        D6 = predication_request.D6,
        D7 = predication_request.D7,
        D8 = predication_request.D8,
        D9 = predication_request.D9,
        D10 = predication_request.D10,
        D11 = predication_request.D11,
        D12 = predication_request.D12,
        D13 = predication_request.D13,
        D14 = predication_request.D14,
        D15 = predication_request.D15,
        M1 = predication_request.M1,
        M2 = predication_request.M2,
        M3 = predication_request.M3,
        M4 = predication_request.M4,
        M5 = predication_request.M5,
        M6 = predication_request.M6,
        M7 = predication_request.M7,
        M8 = predication_request.M8,
        M9 = predication_request.M9,
        V1 = predication_request.V1,
        V2 = predication_request.V2,
        V3 = predication_request.V3,
        V4 = predication_request.V4,
        V5 = predication_request.V5,
        V6 = predication_request.V6,
        V7 = predication_request.V7,
        V8 = predication_request.V8,
        V9 = predication_request.V9,
        V10 = predication_request.V10,
        V11 = predication_request.V11,
        V12 = predication_request.V12,
        V13 = predication_request.V13,
        V14 = predication_request.V14,
        V15 = predication_request.V15,
        V16 = predication_request.V16,
        V17 = predication_request.V17,
        V18 = predication_request.V18,
        V19 = predication_request.V19,
        V20 = predication_request.V20,
        V21 = predication_request.V21,
        V22 = predication_request.V22,
        V23 = predication_request.V23,
        V24 = predication_request.V24,
        V25 = predication_request.V25,
        V26 = predication_request.V26,
        V27 = predication_request.V27,
        V28 = predication_request.V28,
        V29 = predication_request.V29,
        V30 = predication_request.V30,
        V31 = predication_request.V31,
        V32 = predication_request.V32,
        V33 = predication_request.V33,
        V34 = predication_request.V34,
        V35 = predication_request.V35,
        V36 = predication_request.V36,
        V37 = predication_request.V37,
        V38 = predication_request.V38,
        V39 = predication_request.V39,
        V40 = predication_request.V40,
        V41 = predication_request.V41,
        V42 = predication_request.V42,
        V43 = predication_request.V43,
        V44 = predication_request.V44,
        V45 = predication_request.V45,
        V46 = predication_request.V46,
        V47 = predication_request.V47,
        V48 = predication_request.V48,
        V49 = predication_request.V49,
        V50 = predication_request.V50,
        V51 = predication_request.V51,
        V52 = predication_request.V52,
        V53 = predication_request.V53,
        V54 = predication_request.V54,
        V55 = predication_request.V55,
        V56 = predication_request.V56,
        V57 = predication_request.V57,
        V58 = predication_request.V58,
        V59 = predication_request.V59,
        V60 = predication_request.V60,
        V61 = predication_request.V61,
        V62 = predication_request.V62,
        V63 = predication_request.V63,
        V64 = predication_request.V64,
        V65 = predication_request.V65,
        V66 = predication_request.V66,
        V67 = predication_request.V67,
        V68 = predication_request.V68,
        V69 = predication_request.V69,
        V70 = predication_request.V70,
        V71 = predication_request.V71,
        V72 = predication_request.V72,
        V73 = predication_request.V73,
        V74 = predication_request.V74,
        V75 = predication_request.V75,
        V76 = predication_request.V76,
        V77 = predication_request.V77,
        V78 = predication_request.V78,
        V79 = predication_request.V79,
        V80 = predication_request.V80,
        V81 = predication_request.V81,
        V82 = predication_request.V82,
        V83 = predication_request.V83,
        V84 = predication_request.V84,
        V85 = predication_request.V85,
        V86 = predication_request.V86,
        V87 = predication_request.V87,
        V88 = predication_request.V88,
        V89 = predication_request.V89,
        V90 = predication_request.V90,
        V91 = predication_request.V91,
        V92 = predication_request.V92,
        V93 = predication_request.V93,
        V94 = predication_request.V94,
        V95 = predication_request.V95,
        V96 = predication_request.V96,
        V97 = predication_request.V97,
        V98 = predication_request.V98,
        V99 = predication_request.V99,
        V100 = predication_request.V100,
        V101 = predication_request.V101,
        V102 = predication_request.V102,
        V103 = predication_request.V103,
        V104 = predication_request.V104,
        V105 = predication_request.V105,
        V106 = predication_request.V106,
        V107 = predication_request.V107,
        V108 = predication_request.V108,
        V109 = predication_request.V109,
        V110 = predication_request.V110,
        V111 = predication_request.V111,
        V112 = predication_request.V112,
        V113 = predication_request.V113,
        V114 = predication_request.V114,
        V115 = predication_request.V115,
        V116 = predication_request.V116,
        V117 = predication_request.V117,
        V118 = predication_request.V118,
        V119 = predication_request.V119,
        V120 = predication_request.V120,
        V121 = predication_request.V121,
        V122 = predication_request.V122,
        V123 = predication_request.V123,
        V124 = predication_request.V124,
        V125 = predication_request.V125,
        V126 = predication_request.V126,
        V127 = predication_request.V127,
        V128 = predication_request.V128,
        V129 = predication_request.V129,
        V130 = predication_request.V130,
        V131 = predication_request.V131,
        V132 = predication_request.V132,
        V133 = predication_request.V133,
        V134 = predication_request.V134,
        V135 = predication_request.V135,
        V136 = predication_request.V136,
        V137 = predication_request.V137,
        V138 = predication_request.V138,
        V139 = predication_request.V139,
        V140 = predication_request.V140,
        V141 = predication_request.V141,
        V142 = predication_request.V142,
        V143 = predication_request.V143,
        V144 = predication_request.V144,
        V145 = predication_request.V145,
        V146 = predication_request.V146,
        V147 = predication_request.V147,
        V148 = predication_request.V148,
        V149 = predication_request.V149,
        V150 = predication_request.V150,
        V151 = predication_request.V151,
        V152 = predication_request.V152,
        V153 = predication_request.V153,
        V154 = predication_request.V154,
        V155 = predication_request.V155,
        V156 = predication_request.V156,
        V157 = predication_request.V157,
        V158 = predication_request.V158,
        V159 = predication_request.V159,
        V160 = predication_request.V160,
        V161 = predication_request.V161,
        V162 = predication_request.V162,
        V163 = predication_request.V163,
        V164 = predication_request.V164,
        V165 = predication_request.V165,
        V166 = predication_request.V166,
        V167 = predication_request.V167,
        V168 = predication_request.V168,
        V169 = predication_request.V169,
        V170 = predication_request.V170,
        V171 = predication_request.V171,
        V172 = predication_request.V172,
        V173 = predication_request.V173,
        V174 = predication_request.V174,
        V175 = predication_request.V175,
        V176 = predication_request.V176,
        V177 = predication_request.V177,
        V178 = predication_request.V178,
        V179 = predication_request.V179,
        V180 = predication_request.V180,
        V181 = predication_request.V181,
        V182 = predication_request.V182,
        V183 = predication_request.V183,
        V184 = predication_request.V184,
        V185 = predication_request.V185,
        V186 = predication_request.V186,
        V187 = predication_request.V187,
        V188 = predication_request.V188,
        V189 = predication_request.V189,
        V190 = predication_request.V190,
        V191 = predication_request.V191,
        V192 = predication_request.V192,
        V193 = predication_request.V193,
        V194 = predication_request.V194,
        V195 = predication_request.V195,
        V196 = predication_request.V196,
        V197 = predication_request.V197,
        V198 = predication_request.V198,
        V199 = predication_request.V199,
        V200 = predication_request.V200,
        V201 = predication_request.V201,
        V202 = predication_request.V202,
        V203 = predication_request.V203,
        V204 = predication_request.V204,
        V205 = predication_request.V205,
        V206 = predication_request.V206,
        V207 = predication_request.V207,
        V208 = predication_request.V208,
        V209 = predication_request.V209,
        V210 = predication_request.V210,
        V211 = predication_request.V211,
        V212 = predication_request.V212,
        V213 = predication_request.V213,
        V214 = predication_request.V214,
        V215 = predication_request.V215,
        V216 = predication_request.V216,
        V217 = predication_request.V217,
        V218 = predication_request.V218,
        V219 = predication_request.V219,
        V220 = predication_request.V220,
        V221 = predication_request.V221,
        V222 = predication_request.V222,
        V223 = predication_request.V223,
        V224 = predication_request.V224,
        V225 = predication_request.V225,
        V226 = predication_request.V226,
        V227 = predication_request.V227,
        V228 = predication_request.V228,
        V229 = predication_request.V229,
        V230 = predication_request.V230,
        V231 = predication_request.V231,
        V232 = predication_request.V232,
        V233 = predication_request.V233,
        V234 = predication_request.V234,
        V235 = predication_request.V235,
        V236 = predication_request.V236,
        V237 = predication_request.V237,
        V238 = predication_request.V238,
        V239 = predication_request.V239,
        V240 = predication_request.V240,
        V241 = predication_request.V241,
        V242 = predication_request.V242,
        V243 = predication_request.V243,
        V244 = predication_request.V244,
        V245 = predication_request.V245,
        V246 = predication_request.V246,
        V247 = predication_request.V247,
        V248 = predication_request.V248,
        V249 = predication_request.V249,
        V250 = predication_request.V250,
        V251 = predication_request.V251,
        V252 = predication_request.V252,
        V253 = predication_request.V253,
        V254 = predication_request.V254,
        V255 = predication_request.V255,
        V256 = predication_request.V256,
        V257 = predication_request.V257,
        V258 = predication_request.V258,
        V259 = predication_request.V259,
        V260 = predication_request.V260,
        V261 = predication_request.V261,
        V262 = predication_request.V262,
        V263 = predication_request.V263,
        V264 = predication_request.V264,
        V265 = predication_request.V265,
        V266 = predication_request.V266,
        V267 = predication_request.V267,
        V268 = predication_request.V268,
        V269 = predication_request.V269,
        V270 = predication_request.V270,
        V271 = predication_request.V271,
        V272 = predication_request.V272,
        V273 = predication_request.V273,
        V274 = predication_request.V274,
        V275 = predication_request.V275,
        V276 = predication_request.V276,
        V277 = predication_request.V277,
        V278 = predication_request.V278,
        V279 = predication_request.V279,
        V280 = predication_request.V280,
        V281 = predication_request.V281,
        V282 = predication_request.V282,
        V283 = predication_request.V283,
        V284 = predication_request.V284,
        V285 = predication_request.V285,
        V286 = predication_request.V286,
        V287 = predication_request.V287,
        V288 = predication_request.V288,
        V289 = predication_request.V289,
        V290 = predication_request.V290,
        V291 = predication_request.V291,
        V292 = predication_request.V292,
        V293 = predication_request.V293,
        V294 = predication_request.V294,
        V295 = predication_request.V295,
        V296 = predication_request.V296,
        V297 = predication_request.V297,
        V298 = predication_request.V298,
        V299 = predication_request.V299,
        V300 = predication_request.V300,
        V301 = predication_request.V301,
        V302 = predication_request.V302,
        V303 = predication_request.V303,
        V304 = predication_request.V304,
        V305 = predication_request.V305,
        V306 = predication_request.V306,
        V307 = predication_request.V307,
        V308 = predication_request.V308,
        V309 = predication_request.V309,
        V310 = predication_request.V310,
        V311 = predication_request.V311,
        V312 = predication_request.V312,
        V313 = predication_request.V313,
        V314 = predication_request.V314,
        V315 = predication_request.V315,
        V316 = predication_request.V316,
        V317 = predication_request.V317,
        V318 = predication_request.V318,
        V319 = predication_request.V319,
        V320 = predication_request.V320,
        V321 = predication_request.V321,
        V322 = predication_request.V322,
        V323 = predication_request.V323,
        V324 = predication_request.V324,
        V325 = predication_request.V325,
        V326 = predication_request.V326,
        V327 = predication_request.V327,
        V328 = predication_request.V328,
        V329 = predication_request.V329,
        V330 = predication_request.V330,
        V331 = predication_request.V331,
        V332 = predication_request.V332,
        V333 = predication_request.V333,
        V334 = predication_request.V334,
        V335 = predication_request.V335,
        V336 = predication_request.V336,
        V337 = predication_request.V337,
        V338 = predication_request.V338,
        V339 = predication_request.V339,
        account_transaction_id=transaction_result.id,
    )
    predict_task = create_predict_task(predict_task, session)

    send_task_to_queue(predict_task)

    return {
        "task_id": predict_task.id,
    }


@ml_model_router.get("/predictResult/{task_id}")
def get_task(
    task_id: uuid.UUID,
    token: str = Depends(oauth2_scheme),
    session=Depends(get_session),
):
    """Анализ качества вина"""

    user_id = UserService.verify_token(token)
    if user_id is None:
        raise HTTPException(status_code=401, detail="Invalid token")

    task = get_predict_task(task_id, session)
    return {
        "id": task.id,
        "status": task.status,
        'TransactionID': task.TransactionID,
        'id_01': task.id_01,
        'id_02': task.id_02,
        'id_03': task.id_03,
        'id_04': task.id_04,
        'id_05': task.id_05,
        'id_06': task.id_06,
        'id_07': task.id_07,
        'id_08': task.id_08,
        'id_09': task.id_09,
        'id_10': task.id_10,
        'id_11': task.id_11,
        'id_12': task.id_12,
        'id_13': task.id_13,
        'id_14': task.id_14,
        'id_15': task.id_15,
        'id_16': task.id_16,
        'id_17': task.id_17,
        'id_18': task.id_18,
        'id_19': task.id_19,
        'id_20': task.id_20,
        'id_21': task.id_21,
        'id_22': task.id_22,
        'id_23': task.id_23,
        'id_24': task.id_24,
        'id_25': task.id_25,
        'id_26': task.id_26,
        'id_27': task.id_27,
        'id_28': task.id_28,
        'id_29': task.id_29,
        'id_30': task.id_30,
        'id_31': task.id_31,
        'id_32': task.id_32,
        'id_33': task.id_33,
        'id_34': task.id_34,
        'id_35': task.id_35,
        'id_36': task.id_36,
        'id_37': task.id_37,
        'id_38': task.id_38,
        'DeviceType': task.DeviceType,
        'DeviceInfo': task.DeviceInfo,
        'TransactionDT': task.TransactionDT,
        'TransactionAmt': task.TransactionAmt,
        'ProductCD': task.ProductCD,
        'card1': task.card1,
        'card2': task.card2,
        'card3': task.card3,
        'card4': task.card4,
        'card5': task.card5,
        'card6': task.card6,
        'addr1': task.addr1,
        'addr2': task.addr2,
        'dist1': task.dist1,
        'dist2': task.dist2,
        'P_emaildomain': task.P_emaildomain,
        'R_emaildomain': task.R_emaildomain,
        'C1': task.C1,
        'C2': task.C2,
        'C3': task.C3,
        'C4': task.C4,
        'C5': task.C5,
        'C6': task.C6,
        'C7': task.C7,
        'C8': task.C8,
        'C9': task.C9,
        'C10': task.C10,
        'C11': task.C11,
        'C12': task.C12,
        'C13': task.C13,
        'C14': task.C14,
        'D1': task.D1,
        'D2': task.D2,
        'D3': task.D3,
        'D4': task.D4,
        'D5': task.D5,
        'D6': task.D6,
        'D7': task.D7,
        'D8': task.D8,
        'D9': task.D9,
        'D10': task.D10,
        'D11': task.D11,
        'D12': task.D12,
        'D13': task.D13,
        'D14': task.D14,
        'D15': task.D15,
        'M1': task.M1,
        'M2': task.M2,
        'M3': task.M3,
        'M4': task.M4,
        'M5': task.M5,
        'M6': task.M6,
        'M7': task.M7,
        'M8': task.M8,
        'M9': task.M9,
        'V1': task.V1,
        'V2': task.V2,
        'V3': task.V3,
        'V4': task.V4,
        'V5': task.V5,
        'V6': task.V6,
        'V7': task.V7,
        'V8': task.V8,
        'V9': task.V9,
        'V10': task.V10,
        'V11': task.V11,
        'V12': task.V12,
        'V13': task.V13,
        'V14': task.V14,
        'V15': task.V15,
        'V16': task.V16,
        'V17': task.V17,
        'V18': task.V18,
        'V19': task.V19,
        'V20': task.V20,
        'V21': task.V21,
        'V22': task.V22,
        'V23': task.V23,
        'V24': task.V24,
        'V25': task.V25,
        'V26': task.V26,
        'V27': task.V27,
        'V28': task.V28,
        'V29': task.V29,
        'V30': task.V30,
        'V31': task.V31,
        'V32': task.V32,
        'V33': task.V33,
        'V34': task.V34,
        'V35': task.V35,
        'V36': task.V36,
        'V37': task.V37,
        'V38': task.V38,
        'V39': task.V39,
        'V40': task.V40,
        'V41': task.V41,
        'V42': task.V42,
        'V43': task.V43,
        'V44': task.V44,
        'V45': task.V45,
        'V46': task.V46,
        'V47': task.V47,
        'V48': task.V48,
        'V49': task.V49,
        'V50': task.V50,
        'V51': task.V51,
        'V52': task.V52,
        'V53': task.V53,
        'V54': task.V54,
        'V55': task.V55,
        'V56': task.V56,
        'V57': task.V57,
        'V58': task.V58,
        'V59': task.V59,
        'V60': task.V60,
        'V61': task.V61,
        'V62': task.V62,
        'V63': task.V63,
        'V64': task.V64,
        'V65': task.V65,
        'V66': task.V66,
        'V67': task.V67,
        'V68': task.V68,
        'V69': task.V69,
        'V70': task.V70,
        'V71': task.V71,
        'V72': task.V72,
        'V73': task.V73,
        'V74': task.V74,
        'V75': task.V75,
        'V76': task.V76,
        'V77': task.V77,
        'V78': task.V78,
        'V79': task.V79,
        'V80': task.V80,
        'V81': task.V81,
        'V82': task.V82,
        'V83': task.V83,
        'V84': task.V84,
        'V85': task.V85,
        'V86': task.V86,
        'V87': task.V87,
        'V88': task.V88,
        'V89': task.V89,
        'V90': task.V90,
        'V91': task.V91,
        'V92': task.V92,
        'V93': task.V93,
        'V94': task.V94,
        'V95': task.V95,
        'V96': task.V96,
        'V97': task.V97,
        'V98': task.V98,
        'V99': task.V99,
        'V100': task.V100,
        'V101': task.V101,
        'V102': task.V102,
        'V103': task.V103,
        'V104': task.V104,
        'V105': task.V105,
        'V106': task.V106,
        'V107': task.V107,
        'V108': task.V108,
        'V109': task.V109,
        'V110': task.V110,
        'V111': task.V111,
        'V112': task.V112,
        'V113': task.V113,
        'V114': task.V114,
        'V115': task.V115,
        'V116': task.V116,
        'V117': task.V117,
        'V118': task.V118,
        'V119': task.V119,
        'V120': task.V120,
        'V121': task.V121,
        'V122': task.V122,
        'V123': task.V123,
        'V124': task.V124,
        'V125': task.V125,
        'V126': task.V126,
        'V127': task.V127,
        'V128': task.V128,
        'V129': task.V129,
        'V130': task.V130,
        'V131': task.V131,
        'V132': task.V132,
        'V133': task.V133,
        'V134': task.V134,
        'V135': task.V135,
        'V136': task.V136,
        'V137': task.V137,
        'V138': task.V138,
        'V139': task.V139,
        'V140': task.V140,
        'V141': task.V141,
        'V142': task.V142,
        'V143': task.V143,
        'V144': task.V144,
        'V145': task.V145,
        'V146': task.V146,
        'V147': task.V147,
        'V148': task.V148,
        'V149': task.V149,
        'V150': task.V150,
        'V151': task.V151,
        'V152': task.V152,
        'V153': task.V153,
        'V154': task.V154,
        'V155': task.V155,
        'V156': task.V156,
        'V157': task.V157,
        'V158': task.V158,
        'V159': task.V159,
        'V160': task.V160,
        'V161': task.V161,
        'V162': task.V162,
        'V163': task.V163,
        'V164': task.V164,
        'V165': task.V165,
        'V166': task.V166,
        'V167': task.V167,
        'V168': task.V168,
        'V169': task.V169,
        'V170': task.V170,
        'V171': task.V171,
        'V172': task.V172,
        'V173': task.V173,
        'V174': task.V174,
        'V175': task.V175,
        'V176': task.V176,
        'V177': task.V177,
        'V178': task.V178,
        'V179': task.V179,
        'V180': task.V180,
        'V181': task.V181,
        'V182': task.V182,
        'V183': task.V183,
        'V184': task.V184,
        'V185': task.V185,
        'V186': task.V186,
        'V187': task.V187,
        'V188': task.V188,
        'V189': task.V189,
        'V190': task.V190,
        'V191': task.V191,
        'V192': task.V192,
        'V193': task.V193,
        'V194': task.V194,
        'V195': task.V195,
        'V196': task.V196,
        'V197': task.V197,
        'V198': task.V198,
        'V199': task.V199,
        'V200': task.V200,
        'V201': task.V201,
        'V202': task.V202,
        'V203': task.V203,
        'V204': task.V204,
        'V205': task.V205,
        'V206': task.V206,
        'V207': task.V207,
        'V208': task.V208,
        'V209': task.V209,
        'V210': task.V210,
        'V211': task.V211,
        'V212': task.V212,
        'V213': task.V213,
        'V214': task.V214,
        'V215': task.V215,
        'V216': task.V216,
        'V217': task.V217,
        'V218': task.V218,
        'V219': task.V219,
        'V220': task.V220,
        'V221': task.V221,
        'V222': task.V222,
        'V223': task.V223,
        'V224': task.V224,
        'V225': task.V225,
        'V226': task.V226,
        'V227': task.V227,
        'V228': task.V228,
        'V229': task.V229,
        'V230': task.V230,
        'V231': task.V231,
        'V232': task.V232,
        'V233': task.V233,
        'V234': task.V234,
        'V235': task.V235,
        'V236': task.V236,
        'V237': task.V237,
        'V238': task.V238,
        'V239': task.V239,
        'V240': task.V240,
        'V241': task.V241,
        'V242': task.V242,
        'V243': task.V243,
        'V244': task.V244,
        'V245': task.V245,
        'V246': task.V246,
        'V247': task.V247,
        'V248': task.V248,
        'V249': task.V249,
        'V250': task.V250,
        'V251': task.V251,
        'V252': task.V252,
        'V253': task.V253,
        'V254': task.V254,
        'V255': task.V255,
        'V256': task.V256,
        'V257': task.V257,
        'V258': task.V258,
        'V259': task.V259,
        'V260': task.V260,
        'V261': task.V261,
        'V262': task.V262,
        'V263': task.V263,
        'V264': task.V264,
        'V265': task.V265,
        'V266': task.V266,
        'V267': task.V267,
        'V268': task.V268,
        'V269': task.V269,
        'V270': task.V270,
        'V271': task.V271,
        'V272': task.V272,
        'V273': task.V273,
        'V274': task.V274,
        'V275': task.V275,
        'V276': task.V276,
        'V277': task.V277,
        'V278': task.V278,
        'V279': task.V279,
        'V280': task.V280,
        'V281': task.V281,
        'V282': task.V282,
        'V283': task.V283,
        'V284': task.V284,
        'V285': task.V285,
        'V286': task.V286,
        'V287': task.V287,
        'V288': task.V288,
        'V289': task.V289,
        'V290': task.V290,
        'V291': task.V291,
        'V292': task.V292,
        'V293': task.V293,
        'V294': task.V294,
        'V295': task.V295,
        'V296': task.V296,
        'V297': task.V297,
        'V298': task.V298,
        'V299': task.V299,
        'V300': task.V300,
        'V301': task.V301,
        'V302': task.V302,
        'V303': task.V303,
        'V304': task.V304,
        'V305': task.V305,
        'V306': task.V306,
        'V307': task.V307,
        'V308': task.V308,
        'V309': task.V309,
        'V310': task.V310,
        'V311': task.V311,
        'V312': task.V312,
        'V313': task.V313,
        'V314': task.V314,
        'V315': task.V315,
        'V316': task.V316,
        'V317': task.V317,
        'V318': task.V318,
        'V319': task.V319,
        'V320': task.V320,
        'V321': task.V321,
        'V322': task.V322,
        'V323': task.V323,
        'V324': task.V324,
        'V325': task.V325,
        'V326': task.V326,
        'V327': task.V327,
        'V328': task.V328,
        'V329': task.V329,
        'V330': task.V330,
        'V331': task.V331,
        'V332': task.V332,
        'V333': task.V333,
        'V334': task.V334,
        'V335': task.V335,
        'V336': task.V336,
        'V337': task.V337,
        'V338': task.V338,
        'V339': task.V339,
        "isFraud": task.isFraud if task.isFraud is not None else None,
    }


@ml_model_router.get("/history")
def get_prediction_history(
    token: str = Depends(oauth2_scheme), session=Depends(get_session)
) -> List[Prediction]:
    """Просмотр истории запросов на предсказания."""

    user_id = UserService.verify_token(token)
    if user_id is None:
        raise HTTPException(status_code=401, detail="Invalid token")

    predictions = get_predictions(user_id, session)
    return [
        Prediction(
            id=p.id,
            TransactionID=p.TransactionID,
            id_01=p.id_01,
            id_02=p.id_02,
            id_03=p.id_03,
            id_04=p.id_04,
            id_05=p.id_05,
            id_06=p.id_06,
            id_07=p.id_07,
            id_08=p.id_08,
            id_09=p.id_09,
            id_10=p.id_10,
            id_11=p.id_11,
            id_12=p.id_12,
            id_13=p.id_13,
            id_14=p.id_14,
            id_15=p.id_15,
            id_16=p.id_16,
            id_17=p.id_17,
            id_18=p.id_18,
            id_19=p.id_19,
            id_20=p.id_20,
            id_21=p.id_21,
            id_22=p.id_22,
            id_23=p.id_23,
            id_24=p.id_24,
            id_25=p.id_25,
            id_26=p.id_26,
            id_27=p.id_27,
            id_28=p.id_28,
            id_29=p.id_29,
            id_30=p.id_30,
            id_31=p.id_31,
            id_32=p.id_32,
            id_33=p.id_33,
            id_34=p.id_34,
            id_35=p.id_35,
            id_36=p.id_36,
            id_37=p.id_37,
            id_38=p.id_38,
            DeviceType=p.DeviceType,
            DeviceInfo=p.DeviceInfo,
            TransactionDT=p.TransactionDT,
            TransactionAmt=p.TransactionAmt,
            ProductCD=p.ProductCD,
            card1=p.card1,
            card2=p.card2,
            card3=p.card3,
            card4=p.card4,
            card5=p.card5,
            card6=p.card6,
            addr1=p.addr1,
            addr2=p.addr2,
            dist1=p.dist1,
            dist2=p.dist2,
            P_emaildomain=p.P_emaildomain,
            R_emaildomain=p.R_emaildomain,
            C1=p.C1,
            C2=p.C2,
            C3=p.C3,
            C4=p.C4,
            C5=p.C5,
            C6=p.C6,
            C7=p.C7,
            C8=p.C8,
            C9=p.C9,
            C10=p.C10,
            C11=p.C11,
            C12=p.C12,
            C13=p.C13,
            C14=p.C14,
            D1=p.D1,
            D2=p.D2,
            D3=p.D3,
            D4=p.D4,
            D5=p.D5,
            D6=p.D6,
            D7=p.D7,
            D8=p.D8,
            D9=p.D9,
            D10=p.D10,
            D11=p.D11,
            D12=p.D12,
            D13=p.D13,
            D14=p.D14,
            D15=p.D15,
            M1=p.M1,
            M2=p.M2,
            M3=p.M3,
            M4=p.M4,
            M5=p.M5,
            M6=p.M6,
            M7=p.M7,
            M8=p.M8,
            M9=p.M9,
            V1=p.V1,
            V2=p.V2,
            V3=p.V3,
            V4=p.V4,
            V5=p.V5,
            V6=p.V6,
            V7=p.V7,
            V8=p.V8,
            V9=p.V9,
            V10=p.V10,
            V11=p.V11,
            V12=p.V12,
            V13=p.V13,
            V14=p.V14,
            V15=p.V15,
            V16=p.V16,
            V17=p.V17,
            V18=p.V18,
            V19=p.V19,
            V20=p.V20,
            V21=p.V21,
            V22=p.V22,
            V23=p.V23,
            V24=p.V24,
            V25=p.V25,
            V26=p.V26,
            V27=p.V27,
            V28=p.V28,
            V29=p.V29,
            V30=p.V30,
            V31=p.V31,
            V32=p.V32,
            V33=p.V33,
            V34=p.V34,
            V35=p.V35,
            V36=p.V36,
            V37=p.V37,
            V38=p.V38,
            V39=p.V39,
            V40=p.V40,
            V41=p.V41,
            V42=p.V42,
            V43=p.V43,
            V44=p.V44,
            V45=p.V45,
            V46=p.V46,
            V47=p.V47,
            V48=p.V48,
            V49=p.V49,
            V50=p.V50,
            V51=p.V51,
            V52=p.V52,
            V53=p.V53,
            V54=p.V54,
            V55=p.V55,
            V56=p.V56,
            V57=p.V57,
            V58=p.V58,
            V59=p.V59,
            V60=p.V60,
            V61=p.V61,
            V62=p.V62,
            V63=p.V63,
            V64=p.V64,
            V65=p.V65,
            V66=p.V66,
            V67=p.V67,
            V68=p.V68,
            V69=p.V69,
            V70=p.V70,
            V71=p.V71,
            V72=p.V72,
            V73=p.V73,
            V74=p.V74,
            V75=p.V75,
            V76=p.V76,
            V77=p.V77,
            V78=p.V78,
            V79=p.V79,
            V80=p.V80,
            V81=p.V81,
            V82=p.V82,
            V83=p.V83,
            V84=p.V84,
            V85=p.V85,
            V86=p.V86,
            V87=p.V87,
            V88=p.V88,
            V89=p.V89,
            V90=p.V90,
            V91=p.V91,
            V92=p.V92,
            V93=p.V93,
            V94=p.V94,
            V95=p.V95,
            V96=p.V96,
            V97=p.V97,
            V98=p.V98,
            V99=p.V99,
            V100=p.V100,
            V101=p.V101,
            V102=p.V102,
            V103=p.V103,
            V104=p.V104,
            V105=p.V105,
            V106=p.V106,
            V107=p.V107,
            V108=p.V108,
            V109=p.V109,
            V110=p.V110,
            V111=p.V111,
            V112=p.V112,
            V113=p.V113,
            V114=p.V114,
            V115=p.V115,
            V116=p.V116,
            V117=p.V117,
            V118=p.V118,
            V119=p.V119,
            V120=p.V120,
            V121=p.V121,
            V122=p.V122,
            V123=p.V123,
            V124=p.V124,
            V125=p.V125,
            V126=p.V126,
            V127=p.V127,
            V128=p.V128,
            V129=p.V129,
            V130=p.V130,
            V131=p.V131,
            V132=p.V132,
            V133=p.V133,
            V134=p.V134,
            V135=p.V135,
            V136=p.V136,
            V137=p.V137,
            V138=p.V138,
            V139=p.V139,
            V140=p.V140,
            V141=p.V141,
            V142=p.V142,
            V143=p.V143,
            V144=p.V144,
            V145=p.V145,
            V146=p.V146,
            V147=p.V147,
            V148=p.V148,
            V149=p.V149,
            V150=p.V150,
            V151=p.V151,
            V152=p.V152,
            V153=p.V153,
            V154=p.V154,
            V155=p.V155,
            V156=p.V156,
            V157=p.V157,
            V158=p.V158,
            V159=p.V159,
            V160=p.V160,
            V161=p.V161,
            V162=p.V162,
            V163=p.V163,
            V164=p.V164,
            V165=p.V165,
            V166=p.V166,
            V167=p.V167,
            V168=p.V168,
            V169=p.V169,
            V170=p.V170,
            V171=p.V171,
            V172=p.V172,
            V173=p.V173,
            V174=p.V174,
            V175=p.V175,
            V176=p.V176,
            V177=p.V177,
            V178=p.V178,
            V179=p.V179,
            V180=p.V180,
            V181=p.V181,
            V182=p.V182,
            V183=p.V183,
            V184=p.V184,
            V185=p.V185,
            V186=p.V186,
            V187=p.V187,
            V188=p.V188,
            V189=p.V189,
            V190=p.V190,
            V191=p.V191,
            V192=p.V192,
            V193=p.V193,
            V194=p.V194,
            V195=p.V195,
            V196=p.V196,
            V197=p.V197,
            V198=p.V198,
            V199=p.V199,
            V200=p.V200,
            V201=p.V201,
            V202=p.V202,
            V203=p.V203,
            V204=p.V204,
            V205=p.V205,
            V206=p.V206,
            V207=p.V207,
            V208=p.V208,
            V209=p.V209,
            V210=p.V210,
            V211=p.V211,
            V212=p.V212,
            V213=p.V213,
            V214=p.V214,
            V215=p.V215,
            V216=p.V216,
            V217=p.V217,
            V218=p.V218,
            V219=p.V219,
            V220=p.V220,
            V221=p.V221,
            V222=p.V222,
            V223=p.V223,
            V224=p.V224,
            V225=p.V225,
            V226=p.V226,
            V227=p.V227,
            V228=p.V228,
            V229=p.V229,
            V230=p.V230,
            V231=p.V231,
            V232=p.V232,
            V233=p.V233,
            V234=p.V234,
            V235=p.V235,
            V236=p.V236,
            V237=p.V237,
            V238=p.V238,
            V239=p.V239,
            V240=p.V240,
            V241=p.V241,
            V242=p.V242,
            V243=p.V243,
            V244=p.V244,
            V245=p.V245,
            V246=p.V246,
            V247=p.V247,
            V248=p.V248,
            V249=p.V249,
            V250=p.V250,
            V251=p.V251,
            V252=p.V252,
            V253=p.V253,
            V254=p.V254,
            V255=p.V255,
            V256=p.V256,
            V257=p.V257,
            V258=p.V258,
            V259=p.V259,
            V260=p.V260,
            V261=p.V261,
            V262=p.V262,
            V263=p.V263,
            V264=p.V264,
            V265=p.V265,
            V266=p.V266,
            V267=p.V267,
            V268=p.V268,
            V269=p.V269,
            V270=p.V270,
            V271=p.V271,
            V272=p.V272,
            V273=p.V273,
            V274=p.V274,
            V275=p.V275,
            V276=p.V276,
            V277=p.V277,
            V278=p.V278,
            V279=p.V279,
            V280=p.V280,
            V281=p.V281,
            V282=p.V282,
            V283=p.V283,
            V284=p.V284,
            V285=p.V285,
            V286=p.V286,
            V287=p.V287,
            V288=p.V288,
            V289=p.V289,
            V290=p.V290,
            V291=p.V291,
            V292=p.V292,
            V293=p.V293,
            V294=p.V294,
            V295=p.V295,
            V296=p.V296,
            V297=p.V297,
            V298=p.V298,
            V299=p.V299,
            V300=p.V300,
            V301=p.V301,
            V302=p.V302,
            V303=p.V303,
            V304=p.V304,
            V305=p.V305,
            V306=p.V306,
            V307=p.V307,
            V308=p.V308,
            V309=p.V309,
            V310=p.V310,
            V311=p.V311,
            V312=p.V312,
            V313=p.V313,
            V314=p.V314,
            V315=p.V315,
            V316=p.V316,
            V317=p.V317,
            V318=p.V318,
            V319=p.V319,
            V320=p.V320,
            V321=p.V321,
            V322=p.V322,
            V323=p.V323,
            V324=p.V324,
            V325=p.V325,
            V326=p.V326,
            V327=p.V327,
            V328=p.V328,
            V329=p.V329,
            V330=p.V330,
            V331=p.V331,
            V332=p.V332,
            V333=p.V333,
            V334=p.V334,
            V335=p.V335,
            V336=p.V336,
            V337=p.V337,
            V338=p.V338,
            V339=p.V339,
            isFraud=p.isFraud,
            created_at=p.created_at,
        )
        for p in predictions
    ]
